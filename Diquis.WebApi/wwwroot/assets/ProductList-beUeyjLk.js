import{o as D,a as I,r as m,j as e,Q as N,R as O,b as H,S as Z}from"./index-B9lOP-LQ.js";import{c as J,a as L,F as M}from"./object-C6BzUNZs.js";import{u as V,o as W}from"./yup-BjqEEnFb.js";import"./world-DCpaYJzq.js";import{L as X}from"./LoadingButton-CKSAYktE.js";import{M as Y,u as U,a as ee,f as Q,P as te,b as re,e as se,S as oe,g as ie}from"./index-CuAXanPx.js";import{R as A}from"./Row-Bt1Diq2_.js";import{C as v}from"./Col-C-S0H3jR.js";import{B as b}from"./Button-474b3BA8.js";import{O as K,T as G}from"./OverlayTrigger-ULHw02M5.js";import{S as ne}from"./simplebar-react.esm-bGe56t2G.js";import{c as q}from"./clsx-CH7BE6MN.js";import{P as ae}from"./PageLayout-BwASRJfk.js";import{S as ce}from"./Stack-DjFs0eJ8.js";import{C as B}from"./Card-CaF0GZJy.js";import"./ElementChildren-C2-i1Qbu.js";import"./InputGroupContext-DzKQQVdm.js";import"./setPrototypeOf-DgZC2w_0.js";import"./warning-B3rqXDKQ.js";import"./Modal-B-wCig5c.js";import"./listen-DOhMskc_.js";import"./useCallbackRef-B-qOTvYu.js";import"./useEventCallback-B-qJwqMD.js";import"./useMergedRefs-DJgFqpix.js";import"./hasClass-C7eJW1sn.js";import"./useWindow-BKmZcn0M.js";import"./NoopTransition-Bi7248SM.js";import"./TransitionWrapper-BLPpPSai.js";import"./objectWithoutPropertiesLoose-Dsqj8S3w.js";import"./AbstractModalHeader-CEqb6A66.js";import"./contains-xpjwsOxO.js";import"./usePrevious-mZ2y6jh4.js";import"./DataKey-COGXBUcQ.js";import"./CloseButton-BF3uFok-.js";import"./Fade-Dtw2Fl4v.js";import"./divWithClassName-_xz-H_CW.js";import"./Button-dKWbp8U8.js";import"./hook-BNNKBulH.js";import"./extends-CF3RwP-h.js";import"./mergeOptionsWithPopperConfig-CyKv9ruK.js";import"./index-CF5aMJY4.js";const le=({show:n,onHide:l,paginationState:c,filteredQuery:s,sorting:d,isEdit:a=!1,data:t})=>{const{productsStore:h}=I(),{createProduct:g,loading:p,updateProduct:j,loadProducts:P}=h,[f]=m.useState({id:a&&(t==null?void 0:t.id)||"",name:a&&(t==null?void 0:t.name)||"",description:a&&(t==null?void 0:t.description)||"",createdOn:a&&(t==null?void 0:t.createdOn)||""}),u=J({name:L().required("Product name is required"),description:L().required("Description is required")}),r={name:f.name,description:f.description},{reset:o,register:i,handleSubmit:k,formState:{isDirty:S,isValid:E,isSubmitting:z}}=V({defaultValues:r,resolver:W(u)}),w=()=>{o(),l()},F=async y=>{if(a){if(!(t!=null&&t.id))return;try{await j(y,t.id),w(),N.info("Product Updated Successfully!"),await P({pageNumber:c.pageIndex,pageSize:c.pageSize,keyword:s,sorting:d})}catch(x){const C=(x==null?void 0:x.message)||"Update product failed";N.error(C)}}else try{await g(y),w(),N.success("Product Added Successfully!"),await P({pageNumber:c.pageIndex,pageSize:c.pageSize,keyword:s,sorting:d})}catch(x){const C=(x==null?void 0:x.message)||"Create product failed";N.error(C)}},R=async()=>{try{if(!(t!=null&&t.id))return;await h.deleteProduct(t.id),N.error("Product Deleted Successfully!"),await h.loadProducts({pageNumber:1,pageSize:c.pageSize,keyword:s,sorting:d})}catch(y){const x=(y==null?void 0:y.message)||"Update product failed";N.error(x)}};return e.jsx(Y,{show:n,onHide:w,headerTitle:a?"Edit Product":"Add Product",children:e.jsxs("form",{onSubmit:k(F),children:[e.jsxs(A,{className:"mt-1",children:[e.jsx(v,{className:"mt-2",xs:12,sm:8,children:e.jsx(M,{type:"text",label:"Name",placeholder:"Enter Product Name",register:i,name:"name"})}),e.jsx(v,{className:"mt-2",xs:12,children:e.jsx(M,{type:"textarea",rows:"2",label:"Description",placeholder:"Enter Product Description",register:i,name:"description"})})]}),e.jsxs("div",{className:"d-flex w-100 my-3 gap-2",children:[a&&e.jsx(b,{variant:"danger",onClick:R,children:"Delete"}),e.jsx(b,{size:"sm",variant:"light",onClick:()=>w(),className:"ms-auto",children:"Cancel"}),e.jsx(X,{type:"submit",variant:"primary",disabled:!S||!E||z,loading:z||p,children:"Save"})]})]})})},$=D(le),de=D(({product:n})=>{const{productsStore:l}=I(),[c,s]=m.useState(!1),d=async()=>{s(!0),await l.generatePdf(n.id),s(!1)};return e.jsx(b,{variant:"success",className:" mx-2 px-3 py-1 text-sm bg-green-500 text-white rounded-full hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-pill",onClick:d,disabled:c,children:c?"Exporting...":"PDF"})}),_=({pagination:n,filteredQuery:l,sorting:c})=>[{header:"Name",enableSorting:!0,accessorKey:"name",cell:({row:s})=>e.jsx("strong",{className:"text-capitalize text-dark",children:s.original.name})},{header:"Description",enableSorting:!0,accessorKey:"description"},{header:"Guid",enableSorting:!0,accessorKey:"id"},{header:"Actions",accessorKey:"actions",cell:s=>{var p;const{accountStore:d}=I(),{show:a,onShow:t,onHide:h}=U(),g=j=>e.jsx(G,{id:"button-tooltip",className:"font-14",...j,children:"Basic user cannot use this feature"});return e.jsxs(O.Fragment,{children:[e.jsxs("div",{className:"d-flex gap-2 justify-content-end",children:[" ",e.jsx(de,{product:s.row.original}),((p=d.currentUser)==null?void 0:p.roleId)!==H.basic?e.jsx("button",{className:"btn btn-soft-primary rounded-pill",onClick:t,children:"Edit"}):e.jsx(K,{placement:"bottom-start",delay:{show:250,hide:400},overlay:g,children:e.jsx("button",{className:"btn btn-soft-primary rounded-pill","aria-readonly":"true",children:"Edit"})})]}),a&&e.jsx($,{isEdit:!0,show:a,onHide:h,data:s.row.original,paginationState:{pageIndex:n.pageIndex+1,pageSize:n.pageSize},filteredQuery:l,sorting:c})]})}}];function pe(n){const{sorting:l,setSorting:c,pagination:s,setPagination:d,pageCount:a,totalCount:t,hidePagination:h,rowClick:g,isLoading:p,...j}=n,P=r=>{const o=typeof r=="function"?r({pageIndex:s.pageIndex,pageSize:s.pageSize}):r;d(o)},f=r=>{const o=typeof r=="function"?r(l):r;c(o)},u=ee({getFilteredRowModel:se(),manualPagination:!0,manualSorting:!0,state:{pagination:s,sorting:l},pageCount:a,onPaginationChange:P,onSortingChange:f,...j});return e.jsxs("div",{className:"table-responsive",children:[e.jsxs(ne,{children:[e.jsxs("table",{className:q("table table-striped table-centered w-100 nowrap dataTable no-footer"),children:[e.jsx("thead",{children:u.getHeaderGroups().map(r=>e.jsx("tr",{children:r.headers.map(({column:o,getContext:i})=>e.jsx("th",{onClick:o.getToggleSortingHandler(),className:q({sorting_desc:o.getIsSorted()==="desc",sorting_asc:o.getIsSorted()==="asc",sorting:o.columnDef.enableSorting===!0,"cursor-pointer":o.columnDef.enableSorting===!0}),children:Q(o.columnDef.header,i())},o.id))},r.id))}),!p&&e.jsx("tbody",{children:u.getRowModel().rows.map(r=>e.jsx("tr",{onClick:g?()=>g==null?void 0:g(r.original):void 0,children:r.getVisibleCells().map(o=>e.jsx("td",{children:Q(o.column.columnDef.cell,o.getContext())},o.id))},r.id))})]}),p&&e.jsx("div",{className:"my-4 w-100 d-flex justify-content-center",children:e.jsx(Z,{})})]}),!h&&e.jsx(te,{queryPageCount:u.getPageCount(),queryPageSize:u.getState().pagination.pageSize,queryPageIndex:u.getState().pagination.pageIndex,totalCount:t,isLoading:p===void 0?!0:p,goToPage:u.setPageIndex,setPageSize:u.setPageSize,sizePerPageList:re})]})}const ue=n=>{const l=c=>{const{value:s}=c.target;n.setSearchQuery(s)};return e.jsxs(A,{children:[e.jsx(v,{xs:12,md:3,children:e.jsxs(ce,{direction:"horizontal",gap:2,className:"align-items-stretch",children:[e.jsx(oe,{value:n.searchQuery,onChange:l,placeholder:n.searchInputPlaceholder,name:"search-input"}),n.searchQuery&&e.jsx(b,{variant:"info",onClick:n.handleFilter,children:"Filter"})]})}),e.jsx(v,{xs:12,md:9}),e.jsx(v,{xs:12,children:n.filteredQuery&&e.jsxs("div",{className:"d-flex my-2 gap-1 fs-4",children:[e.jsxs("p",{className:"text-secondary",children:["Showing results for ",e.jsxs("strong",{children:['"',n.filteredQuery,'",']})]}),e.jsx("p",{className:"cursor-pointer hover-primary fst-italic text-secondary text-decoration-underline",onClick:n.handleClearFilters,children:"Clear?"})]})})]})},me=()=>{var C;const{productsStore:n,accountStore:l,layoutStore:c}=I(),{loadProducts:s,products:d,productMetaData:a,loadingInitial:t,exportProducts:h,loadingExport:g}=n,{show:p,onShow:j,onHide:P}=U(),[f,u]=m.useState(""),[r,o]=m.useState(""),[i,k]=m.useState({pageIndex:0,pageSize:c.pageSize}),[S,E]=m.useState([]),z=m.useMemo(()=>d,[d]),w=m.useMemo(()=>_({pagination:i,filteredQuery:r,sorting:S}),[_,i,r,S]),F=m.useCallback(()=>{u(""),o(f),s({pageNumber:i.pageIndex+1,pageSize:i.pageSize,keyword:f})},[i,f]),R=m.useCallback(()=>{o(""),s({pageNumber:i.pageIndex+1,pageSize:i.pageSize})},[i]),y=T=>e.jsx(G,{id:"button-tooltip",className:"font-14",...T,children:"Basic user cannot use this feature"});m.useEffect(()=>{s({pageNumber:i.pageIndex+1,pageSize:i.pageSize,keyword:r,sorting:S})},[s,i.pageSize,i.pageIndex,r,S]);const x=m.useCallback(async()=>{try{await h({keyword:r,sorting:S,filename:"products-export.xlsx"}),console.log("Export completed successfully")}catch(T){console.error("Export failed:",T)}},[h,r,S]);return e.jsxs(ae,{title:"Products",action:((C=l.currentUser)==null?void 0:C.roleId)!==H.basic?e.jsx(b,{variant:"primary",onClick:j,children:"New Product"}):e.jsx(K,{placement:"bottom-start",delay:{show:250,hide:400},overlay:y,children:e.jsx("span",{children:e.jsx(b,{disabled:!0,variant:"primary",children:"New Product"})})}),children:[e.jsx(B,{className:"pt-2",children:e.jsxs(B.Body,{children:[e.jsx(ue,{searchInputPlaceholder:"Search products...",handleClearFilters:R,searchQuery:f,setSearchQuery:u,filteredQuery:r,setFilteredQuery:o,handleFilter:F}),p&&e.jsx($,{show:p,onHide:P,isEdit:!1,paginationState:{pageIndex:i.pageIndex+1,pageSize:i.pageSize},filteredQuery:r,sorting:S}),e.jsx(pe,{data:z,columns:w,getCoreRowModel:ie(),sorting:S,setSorting:E,pagination:i,setPagination:k,pageCount:(a==null?void 0:a.totalPages)??0,totalCount:(a==null?void 0:a.totalCount)??0,isLoading:t})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-2 mb-4 w-full",children:[e.jsx("small",{children:"Server-side pagination with sorting & filtering"}),e.jsx(b,{variant:"success",onClick:x,disabled:g,children:g?"Exporting...":"Export"})]})]})},tt=D(me);export{tt as default};
