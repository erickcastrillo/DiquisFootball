import{o as q,a as R,b as _,r as m,j as e,Q as k,R as V,d as A,S as W}from"./index-DZyfIAu_.js";import{c as X,a as B,F as D}from"./object-DCB-L6RT.js";import{u as Y,o as ee}from"./yup-xyZlI54A.js";import"./world-BQlB_TTF.js";import{L as te}from"./LoadingButton-CfXmehaF.js";import{M as oe,u as $,a as se,f as H,P as re,b as ae,e as ne,S as ie,g as ce}from"./index-DLjRr-q5.js";import{R as G}from"./Row-D51VfxT-.js";import{C as F}from"./Col-Cz1u6dla.js";import{B as C}from"./Button-CbTZNhGo.js";import{O,T as Z}from"./OverlayTrigger-6FT0-wZp.js";import{S as le}from"./simplebar-react.esm-Cgqq1i5A.js";import{c as U}from"./clsx-CH7BE6MN.js";import{P as de}from"./PageLayout-UL-g3efH.js";import{S as pe}from"./Stack-yzggaGWM.js";import{C as K}from"./Card-BcnLHcba.js";import"./ElementChildren-ASgpluZ9.js";import"./InputGroupContext-TwirTIt2.js";import"./setPrototypeOf-DgZC2w_0.js";import"./warning-DRYvq3ZW.js";import"./Modal-DR78ItKK.js";import"./listen-DOhMskc_.js";import"./useCallbackRef-BbKjLmD3.js";import"./useEventCallback-hjjgLohZ.js";import"./useMergedRefs-MQSzYiRk.js";import"./hasClass-C8tlBkMT.js";import"./useWindow-CPm0dSzS.js";import"./NoopTransition-9eZ7ujJa.js";import"./TransitionWrapper-CsTLgaP5.js";import"./objectWithoutPropertiesLoose-Dsqj8S3w.js";import"./AbstractModalHeader-BiwI7-FI.js";import"./contains-xpjwsOxO.js";import"./usePrevious-mhA-54pg.js";import"./DataKey-COGXBUcQ.js";import"./CloseButton-CTRRufWV.js";import"./Fade-6qqgLZnl.js";import"./divWithClassName--d4LxeB8.js";import"./Button-BuCi24HL.js";import"./hook-BgHE0WuW.js";import"./extends-CF3RwP-h.js";import"./mergeOptionsWithPopperConfig-C7d_kRm9.js";import"./index-CeMukgnl.js";const ue=({show:n,onHide:g,paginationState:d,filteredQuery:o,sorting:c,isEdit:p=!1,data:t})=>{const{productsStore:j}=R(),{createProduct:h,loading:S,updateProduct:i,loadProducts:y}=j,{t:s,i18n:P}=_(),[u]=m.useState({id:p&&(t==null?void 0:t.id)||"",name:p&&(t==null?void 0:t.name)||"",description:p&&(t==null?void 0:t.description)||"",createdOn:p&&(t==null?void 0:t.createdOn)||"",locale:p&&(t==null?void 0:t.locale)||P.language}),r=X({name:B().required(s("products.modal.validation.nameRequired")),description:B().required(s("products.modal.validation.descriptionRequired"))}),a={name:u.name,description:u.description},{reset:x,register:v,handleSubmit:l,formState:{isDirty:L,isValid:f,isSubmitting:T}}=Y({defaultValues:a,resolver:ee(r)}),z=()=>{x(),g()},E=async w=>{const N={...w,locale:P.language.charAt(0).toUpperCase()+P.language.slice(1)};if(p){if(!(t!=null&&t.id))return;try{await i(N,t.id),z(),k.info(s("products.modal.updateSuccess")),await y({pageNumber:d.pageIndex,pageSize:d.pageSize,keyword:o,sorting:c})}catch(b){const I=(b==null?void 0:b.message)||s("products.modal.updateFailed");k.error(I)}}else try{await h(N),z(),k.success(s("products.modal.createSuccess")),await y({pageNumber:d.pageIndex,pageSize:d.pageSize,keyword:o,sorting:c})}catch(b){const I=(b==null?void 0:b.message)||s("products.modal.createFailed");k.error(I)}},M=async()=>{try{if(!(t!=null&&t.id))return;await j.deleteProduct(t.id),k.error(s("products.modal.deleteSuccess")),await j.loadProducts({pageNumber:1,pageSize:d.pageSize,keyword:o,sorting:c})}catch(w){const N=(w==null?void 0:w.message)||s("products.modal.updateFailed");k.error(N)}};return e.jsx(oe,{show:n,onHide:z,headerTitle:s(p?"products.modal.editTitle":"products.modal.addTitle"),children:e.jsxs("form",{onSubmit:l(E),children:[e.jsxs(G,{className:"mt-1",children:[e.jsx(F,{className:"mt-2",xs:12,children:e.jsx(D,{type:"text",label:s("products.modal.nameLabel"),placeholder:s("products.modal.namePlaceholder"),register:v,name:"name"})}),e.jsx(F,{className:"mt-2",xs:12,children:e.jsx(D,{type:"textarea",rows:"2",label:s("products.modal.descriptionLabel"),placeholder:s("products.modal.descriptionPlaceholder"),register:v,name:"description"})})]}),e.jsxs("div",{className:"d-flex w-100 my-3 gap-2",children:[p&&e.jsx(C,{variant:"danger",onClick:M,children:s("products.modal.delete")}),e.jsx(C,{size:"sm",variant:"light",onClick:()=>z(),className:"ms-auto",children:s("products.modal.cancel")}),e.jsx(te,{type:"submit",variant:"primary",disabled:!L||!f||T,loading:T||S,children:s("products.modal.save")})]})]})})},J=q(ue),me=q(({product:n})=>{const{productsStore:g}=R(),[d,o]=m.useState(!1),c=async()=>{o(!0),await g.generatePdf(n.id),o(!1)};return e.jsx(C,{variant:"success",className:" mx-2 px-3 py-1 text-sm bg-green-500 text-white rounded-full hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-pill",onClick:c,disabled:d,children:d?"Exporting...":"PDF"})}),ge=({pagination:n,filteredQuery:g,sorting:d,t:o})=>[{header:o("products.columns.name"),enableSorting:!0,accessorKey:"name",cell:({row:c})=>e.jsx("strong",{className:"text-capitalize text-dark",children:c.original.name})},{header:o("products.columns.description"),enableSorting:!0,accessorKey:"description"},{header:o("products.columns.guid"),enableSorting:!0,accessorKey:"id"},{header:o("products.columns.actions"),accessorKey:"actions",cell:c=>{var i;const{accountStore:p}=R(),{show:t,onShow:j,onHide:h}=$(),S=y=>e.jsx(Z,{id:"button-tooltip",className:"font-14",...y,children:o("products.basicUserTooltip")});return e.jsxs(V.Fragment,{children:[e.jsxs("div",{className:"d-flex gap-2 justify-content-end",children:[e.jsx(me,{product:c.row.original}),((i=p.currentUser)==null?void 0:i.roleId)!==A.basic?e.jsx("button",{className:"btn btn-soft-primary rounded-pill",onClick:j,children:o("products.columns.edit")}):e.jsx(O,{placement:"bottom-start",delay:{show:250,hide:400},overlay:S,children:e.jsx("button",{className:"btn btn-soft-primary rounded-pill","aria-readonly":"true",children:o("products.columns.edit")})})]}),t&&e.jsx(J,{isEdit:!0,show:t,onHide:h,data:c.row.original,paginationState:{pageIndex:n.pageIndex+1,pageSize:n.pageSize},filteredQuery:g,sorting:d})]})}}];function xe(n){const{sorting:g,setSorting:d,pagination:o,setPagination:c,pageCount:p,totalCount:t,hidePagination:j,rowClick:h,isLoading:S,...i}=n,{t:y}=_(),s=r=>{const a=typeof r=="function"?r({pageIndex:o.pageIndex,pageSize:o.pageSize}):r;c(a)},P=r=>{const a=typeof r=="function"?r(g):r;d(a)},u=se({getFilteredRowModel:ne(),manualPagination:!0,manualSorting:!0,state:{pagination:o,sorting:g},pageCount:p,onPaginationChange:s,onSortingChange:P,...i});return e.jsxs("div",{className:"table-responsive",children:[e.jsxs(le,{children:[e.jsxs("table",{className:U("table table-striped table-centered w-100 nowrap dataTable no-footer"),children:[e.jsx("thead",{children:u.getHeaderGroups().map(r=>e.jsx("tr",{children:r.headers.map(({column:a,getContext:x})=>e.jsx("th",{onClick:a.getToggleSortingHandler(),className:U({sorting_desc:a.getIsSorted()==="desc",sorting_asc:a.getIsSorted()==="asc",sorting:a.columnDef.enableSorting===!0,"cursor-pointer":a.columnDef.enableSorting===!0}),children:H(a.columnDef.header,x())},a.id))},r.id))}),!S&&e.jsx("tbody",{children:u.getRowModel().rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:u.getAllColumns().length,className:"text-center",children:y("tables.noResults")})}):u.getRowModel().rows.map(r=>e.jsx("tr",{onClick:h?()=>h==null?void 0:h(r.original):void 0,children:r.getVisibleCells().map(a=>e.jsx("td",{children:H(a.column.columnDef.cell,a.getContext())},a.id))},r.id))})]}),S&&e.jsx("div",{className:"my-4 w-100 d-flex justify-content-center",children:e.jsx(W,{})})]}),!j&&e.jsx(re,{queryPageCount:u.getPageCount(),queryPageSize:u.getState().pagination.pageSize,queryPageIndex:u.getState().pagination.pageIndex,totalCount:t,isLoading:S===void 0?!0:S,goToPage:u.setPageIndex,setPageSize:u.setPageSize,sizePerPageList:ae})]})}const he=n=>{const g=d=>{const{value:o}=d.target;n.setSearchQuery(o)};return e.jsxs(G,{children:[e.jsx(F,{xs:12,md:3,children:e.jsxs(pe,{direction:"horizontal",gap:2,className:"align-items-stretch",children:[e.jsx(ie,{value:n.searchQuery,onChange:g,placeholder:n.searchInputPlaceholder,name:"search-input"}),n.searchQuery&&e.jsx(C,{variant:"info",onClick:n.handleFilter,children:"Filter"})]})}),e.jsx(F,{xs:12,md:9}),e.jsx(F,{xs:12,children:n.filteredQuery&&e.jsxs("div",{className:"d-flex my-2 gap-1 fs-4",children:[e.jsxs("p",{className:"text-secondary",children:["Showing results for ",e.jsxs("strong",{children:['"',n.filteredQuery,'",']})]}),e.jsx("p",{className:"cursor-pointer hover-primary fst-italic text-secondary text-decoration-underline",onClick:n.handleClearFilters,children:"Clear?"})]})})]})},Se=()=>{var I;const{productsStore:n,accountStore:g,layoutStore:d,authStore:o}=R(),{loadProducts:c,products:p,productMetaData:t,loadingInitial:j,exportProducts:h,loadingExport:S}=n,{t:i,i18n:y}=_();m.useEffect(()=>{o.setTitle(i("products.title"))},[i,o,y.language]);const{show:s,onShow:P,onHide:u}=$(),[r,a]=m.useState(""),[x,v]=m.useState(""),[l,L]=m.useState({pageIndex:0,pageSize:d.pageSize}),[f,T]=m.useState([]),z=m.useMemo(()=>p||[],[p]),E=m.useMemo(()=>ge({pagination:l,filteredQuery:x,sorting:f,t:i}),[l,x,f,i]),M=m.useCallback(()=>{a(""),v(r),c({pageNumber:l.pageIndex+1,pageSize:l.pageSize,keyword:r})},[l,r]),w=m.useCallback(()=>{v(""),c({pageNumber:l.pageIndex+1,pageSize:l.pageSize})},[l]),N=Q=>e.jsx(Z,{id:"button-tooltip",className:"font-14",...Q,children:i("products.basicUserTooltip")});m.useEffect(()=>{c({pageNumber:l.pageIndex+1,pageSize:l.pageSize,keyword:x,sorting:f})},[c,l.pageSize,l.pageIndex,x,f]);const b=m.useCallback(async()=>{try{await h({keyword:x,sorting:f,filename:"products-export.xlsx"}),console.log("Export completed successfully")}catch(Q){console.error("Export failed:",Q)}},[h,x,f]);return e.jsxs(de,{action:((I=g.currentUser)==null?void 0:I.roleId)!==A.basic?e.jsx(C,{variant:"primary",onClick:P,children:i("products.newProduct")}):e.jsx(O,{placement:"bottom-start",delay:{show:250,hide:400},overlay:N,children:e.jsx("span",{children:e.jsx(C,{disabled:!0,variant:"primary",children:i("products.newProduct")})})}),children:[e.jsx(K,{className:"pt-2",children:e.jsxs(K.Body,{children:[e.jsx(he,{searchInputPlaceholder:i("products.searchPlaceholder"),handleClearFilters:w,searchQuery:r,setSearchQuery:a,filteredQuery:x,setFilteredQuery:v,handleFilter:M}),s&&e.jsx(J,{show:s,onHide:u,isEdit:!1,paginationState:{pageIndex:l.pageIndex+1,pageSize:l.pageSize},filteredQuery:x,sorting:f}),e.jsx(xe,{data:z,columns:E,getCoreRowModel:ce(),sorting:f,setSorting:T,pagination:l,setPagination:L,pageCount:(t==null?void 0:t.totalPages)??0,totalCount:(t==null?void 0:t.totalCount)??0,isLoading:j})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-2 mb-4 w-full",children:[e.jsx("small",{children:i("products.paginationDescription")}),e.jsx(C,{variant:"success",onClick:b,disabled:S,children:i(S?"products.exporting":"products.export")})]})]})},at=q(Se);export{at as default};
