import{s as oe,_ as ne}from"./layout-XCMcHSfz.js";import{s as X,r as S,c as Y,d as b,l as x,f as c,g as s,h as r,v as V,x as se,y as le,w as n,e as h,F as R,z as B,i as d,A as re,B as ie,t as A,q as ce,m as J,j as K,k,C as de,D as N,E as P,G as T,H as ue,o as pe}from"./index-BO7LP-gy.js";import{u as ge,F as Q,g as me,a as fe,b as be,c as _e,d as ve,A as Pe}from"./avatar-title-group-BK_MrQxr.js";import{u as ye,_ as I}from"./loading-button-BPnIwY7F.js";import{c as he,a as W}from"./index.esm-DqsvCYYq.js";import"./logo-Jz-mcktN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Se={class:"card"},we={class:"card-body"},xe={class:"d-flex align-items-end gap-2"},Ce={class:"mb-2"},Me=s("label",{for:"searchInput",class:"form-label"},"Search:",-1),ke=["placeholder"],De={class:"mb-2"},$e=s("div",{class:"mb-2"},[s("div",{class:"text-sm-end"})],-1),ze=s("div",{class:"text-center"},"No data available in table",-1),Le={key:0,class:"d-flex justify-content-center p-4"},Ne=s("span",{class:"spinner-border spinner-border-sm avatar-sm text-primary",role:"status","aria-hidden":"true"},null,-1),Re=[Ne],Ve={class:"table-footer"},Ue={class:"table-footer__info"},Be={key:0},Fe={class:"table-footer__controls"},Ee=["value"],je=["value"],Ae={class:"pagination pagination-rounded mb-0"},Ie={__name:"server-table",props:{data:Object,columns:Array,loading:Boolean,currentPageMeta:Object,tablePaginationMeta:Object,filterPlaceholder:String},emits:["onParamsChange"],setup(t,{emit:a}){const l=X(),e=t,i=a,u=[5,10,25,50],_=S([]),w=S(""),m=S({}),v=ge({get data(){return e.data},get columns(){return e.columns},manualSorting:!0,manualPagination:!0,manualFiltering:!0,getCoreRowModel:_e(),getPaginationRowModel:be(),getSortedRowModel:fe(),getFilteredRowModel:me(),initialState:{pagination:{pageSize:l.pageSize}},state:{get sorting(){return _.value}},onPaginationChange:p=>{m.value=typeof p=="function"?p(m.value):p;let o={...e.currentPageMeta};m.value.pageSize&&m.value.pageSize!=e.currentPageMeta.pageSize?(o.pageSize=m.value.pageSize,o.pageNumber=1):o.pageNumber=m.value.pageIndex,console.log(m.value),i("onParamsChange",o)},onSortingChange:p=>{_.value=typeof p=="function"?p(_.value):p;let o={...e.currentPageMeta};o.sorting=_.value,i("onParamsChange",o)}}),C=Y(()=>{let p=e.tablePaginationMeta.pageSize*e.currentPageMeta.pageNumber-e.tablePaginationMeta.pageSize+1,o=e.tablePaginationMeta.pageSize*e.currentPageMeta.pageNumber,z=Math.ceil(e.tablePaginationMeta.totalCount/e.tablePaginationMeta.pageSize);return e.currentPageMeta.pageNumber==z&&(o=e.tablePaginationMeta.totalCount),e.tablePaginationMeta.totalCount==0?"No results":"Showing "+p+" to "+o+" of "+e.tablePaginationMeta.totalCount+" entries"});return(p,o)=>{const z=b("b-th"),D=b("b-tr"),$=b("b-thead"),M=b("b-td"),U=b("b-tbody"),O=b("b-table-simple"),E=b("b-pagination");return c(),x("div",Se,[s("div",we,[s("div",xe,[s("div",Ce,[Me,se(s("input",{id:"searchInput",type:"text",placeholder:e.filterPlaceholder,class:"form-control","onUpdate:modelValue":o[0]||(o[0]=g=>w.value=g),style:{"max-width":"250px"}},null,8,ke),[[le,w.value]])]),s("div",De,[s("button",{id:"filter",type:"button",class:"btn btn-info",onClick:o[1]||(o[1]=()=>i("onParamsChange",{...e.currentPageMeta,keyword:w.value}))},"Filter")]),$e]),r(d(oe),{class:"table-responsive","data-simplebar-auto-hide":"false"},{default:n(()=>[r(O,{class:"table table-striped table-centered w-100 nowrap dataTable"},{default:n(()=>[r($,null,{default:n(()=>[(c(!0),x(R,null,B(d(v).getHeaderGroups(),g=>(c(),h(D,{key:g.id},{default:n(()=>[(c(!0),x(R,null,B(g.headers,f=>(c(),h(z,{key:f.id,colSpan:f.colSpan,onClick:y=>{var j;return(j=f.column.getToggleSortingHandler())==null?void 0:j(y)},class:ie({sorting:f.column.columnDef.enableSorting,sorting_desc:f.column.getIsSorted()=="desc",sorting_asc:f.column.getIsSorted()=="asc"}),style:re({width:`${f.getSize()}px`})},{default:n(()=>[f.isPlaceholder?V("",!0):(c(),h(d(Q),{key:0,render:f.column.columnDef.label,props:f.getContext()},null,8,["render","props"]))]),_:2},1032,["colSpan","onClick","class","style"]))),128))]),_:2},1024))),128))]),_:1}),t.loading?V("",!0):(c(),h(U,{key:0},{default:n(()=>[t.data.length?(c(!0),x(R,{key:0},B(d(v).getRowModel().rows,g=>(c(),h(D,{key:g.id},{default:n(()=>[(c(!0),x(R,null,B(g.getVisibleCells(),f=>(c(),h(M,{key:f.id},{default:n(()=>[r(d(Q),{render:f.column.columnDef.cell,props:f.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(c(),h(D,{key:1},{default:n(()=>[r(M,{colspan:"4"},{default:n(()=>[ze]),_:1})]),_:1}))]),_:1}))]),_:1})]),_:1}),t.loading?(c(),x("div",Le,Re)):V("",!0),s("div",Ve,[s("div",Ue,[t.loading?V("",!0):(c(),x("span",Be,A(C.value),1))]),s("div",Fe,[ce(p.$slots,"export"),s("select",{class:"form-select",value:e.currentPageMeta.pageSize,onChange:o[2]||(o[2]=g=>d(v).setPageSize(g.target.value))},[(c(),x(R,null,B(u,g=>s("option",{key:g,value:g},A(g),9,je)),64))],40,Ee),s("ul",Ae,[r(E,{modelValue:e.currentPageMeta.pageNumber,"onUpdate:modelValue":[o[3]||(o[3]=g=>e.currentPageMeta.pageNumber=g),o[4]||(o[4]=g=>d(v).setPageIndex(e.currentPageMeta.pageNumber))],"total-rows":e.tablePaginationMeta.totalCount,"per-page":e.currentPageMeta.pageSize},null,8,["modelValue","total-rows","per-page"])])])])])])}}},Oe={class:""},Te={class:"modal-footer footer-controls border-top-0"},He={class:"footer-controls__left"},qe={class:"footer-controls__right"},Z={__name:"product-modal",props:{title:{type:String,required:!0},data:{type:Object,required:!1},saving:{type:Boolean,default:!1},deleting:{type:Boolean,default:!1},enableDelete:{type:Boolean,default:!1}},emits:["proceed","cancel","proceedDelete"],setup(t,{emit:a}){var E,g;const l=a,e=t,i=S({name:((E=e.data)==null?void 0:E.name)||"",description:((g=e.data)==null?void 0:g.description)||""}),u=he({name:W().required(),description:W().required()}),{handleSubmit:_,defineField:w,errors:m,meta:v}=ye({initialValues:i,validationSchema:u}),[C,p]=w("name"),[o,z]=w("description"),D=Y(()=>v.value.dirty&&v.value.valid),$=S(!0),M=async()=>{$.value=!1,l("cancel")},U=_(f=>{let y={...e.data,...f};l("proceed",y)}),O=_(()=>{l("proceedDelete",e.data.id)});return(f,y)=>{const j=b("b-form-input"),q=b("b-form-invalid-feedback"),G=b("b-form-group"),ee=b("b-form-textarea"),te=b("b-button"),ae=b("b-modal");return c(),h(ae,{modelValue:$.value,"onUpdate:modelValue":y[3]||(y[3]=L=>$.value=L),title:t.title,"title-class":"h4",size:"lg","hide-footer":"",onCancel:M,onClose:M,onHidden:M},{default:n(()=>[s("div",Oe,[s("form",{onSubmit:y[2]||(y[2]=(...L)=>d(U)&&d(U)(...L)),class:"my-2"},[r(G,{label:"Name","label-for":"name",class:"mb-2",style:{"max-width":"400px"}},{default:n(()=>[r(j,J({type:"text"},d(p),{modelValue:d(C),"onUpdate:modelValue":y[0]||(y[0]=L=>K(C)?C.value=L:null),id:"name"}),null,16,["modelValue"]),r(q,{state:!1},{default:n(()=>[k(A(d(m).name),1)]),_:1})]),_:1}),r(G,{label:"Description","label-for":"description"},{default:n(()=>[r(ee,J({type:"text",rows:"3"},d(z),{modelValue:d(o),"onUpdate:modelValue":y[1]||(y[1]=L=>K(o)?o.value=L:null)}),null,16,["modelValue"]),r(q,{state:!1},{default:n(()=>[k(A(d(m).description),1)]),_:1})]),_:1})],32)]),s("div",Te,[s("div",He,[t.enableDelete?(c(),h(I,{key:0,variant:"danger",type:"submit",loading:t.deleting,onClick:d(O),disabled:t.saving},{default:n(()=>[k("Delete")]),_:1},8,["loading","onClick","disabled"])):V("",!0)]),s("div",qe,[r(te,{variant:"light",onClick:M},{default:n(()=>[k("Close")]),_:1}),r(I,{variant:"primary",type:"submit",loading:t.saving,onClick:d(U),disabled:!D.value},{default:n(()=>[k("Save")]),_:1},8,["loading","onClick","disabled"])])])]),_:1},8,["modelValue","title"])}}},H=de("products",{state:()=>({productList:{},paginationMetaData:{},exportingState:!1}),getters:{products:t=>t.productList,paginationMeta:t=>t.paginationMetaData,exporting:t=>t.exportingState},actions:{async getProducts(){const t=await N.get("/products");this.productList=t.data},async getProductsPaginated(t){const a=await N.post("/products/products-paginated",t);this.productList=a.data,delete a.data,this.paginationMetaData=a},async addProduct(t){try{const a=await N.post("/products",t);return a.succeeded?(t.id=a.data,t.createdOn=new Date().toISOString(),this.productList=[t,...this.productList],P.success("New product added"),!0):(P.error(a.messages[0]),!1)}catch(a){return P.error(a),!1}},async updateProduct(t){try{const a=await N.put(`/products/${t.id}`,t);if(a.succeeded){const l=this.productList.map(e=>e.id===t.id?t:e);return this.productList=l,P.success("Product updated"),!0}else return P.error(a.messages[0]),!1}catch(a){return P.error(a),!1}},async deleteProduct(t){try{const a=await N.delete(`/products/${t}`);if(a.succeeded){const l=this.productList.filter(e=>e.id!==t);return this.productList=l,P.success("Product deleted"),!0}else return P.error(a.messages[0]),!1}catch(a){return P.error(a),!1}},async exportProducts(){try{this.exportingState=!0;const t=await N.postBlob("/products/export");this.exportingState=!1;const a=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),e=new Date().toISOString().split("T")[0],i=window.URL.createObjectURL(a),u=document.createElement("a");return u.href=i,u.download=`Products-${e}.xlsx`,u.click(),window.URL.revokeObjectURL(i),P.success("Exported list"),!0}catch(t){return this.exportingState=!1,P.error("Export failed"),console.error(t),!1}},async generatePdf(t){try{const a=await N.postBlob(`/products/pdf/${t}`),l=new Blob([a.data],{type:"application/pdf"}),e=t.slice(0,6).toUpperCase(),i=window.URL.createObjectURL(l),u=document.createElement("a");return u.href=i,u.download=`Product-${e}.pdf`,u.click(),window.URL.revokeObjectURL(i),P.success("Created PDF"),!0}catch(a){return this.exportingState=!1,P.error("PDF creation failed"),console.error(a),!1}}}}),Ge={__name:"edit-product",props:["targetProduct"],setup(t){const a=H(),l=t,e=S(!1),i=S(!1),u=S(!1),_=async m=>{i.value=!0,await a.updateProduct(m)&&(e.value=!1),i.value=!1},w=async m=>{u.value=!0,await a.deleteProduct(m)&&(e.value=!1),u.value=!1};return(m,v)=>{const C=b("b-button");return c(),x(R,null,[r(C,{variant:"soft-primary",pill:"",onClick:v[0]||(v[0]=p=>e.value=!0),class:"float-end"},{default:n(()=>[k("Edit")]),_:1}),e.value?(c(),h(Z,{key:0,title:"Edit Product",data:l.targetProduct,saving:i.value,deleting:u.value,onProceed:_,onProceedDelete:w,onCancel:v[1]||(v[1]=p=>e.value=!1),enableDelete:""},null,8,["data","saving","deleting"])):V("",!0)],64)}}},Je={__name:"generate-pdf-button",props:["product"],setup(t){const a=H(),l=t,e=S(!1),i=async()=>{e.value=!0,await a.generatePdf(l.product.id),e.value=!1};return(u,_)=>(c(),h(I,{variant:"success",size:"sm",pill:"",class:"mx-2",onClick:i,loading:e.value,disabled:e.value},{default:n(()=>[k("PDF")]),_:1},8,["loading","disabled"]))}},F=ve(),Ke=[F.accessor("name",{label:"Name",enableSorting:!0,cell:({row:t})=>T(Pe,{title:t.original.name,hideAvatar:!0})}),F.accessor("description",{label:"Description",enableSorting:!0}),F.accessor("id",{label:"Guid",enableSorting:!0}),F.accessor("pdf",{label:"",enableSorting:!1,size:50,cell:({row:t})=>T(Je,{product:t.original})}),F.accessor("edit",{label:"",enableSorting:!1,size:50,cell:({row:t})=>T(Ge,{targetProduct:t.original})})],Qe=s("div",{class:"mb-2"},[s("small",null,"Server-side pagination with sorting & filtering")],-1),ot={__name:"products-list",setup(t){const a=X(),l=H(),e=S(!1),i=S(!1),u=S(!1);let _=ue({pageNumber:1,pageSize:a.pageSize,keyword:"",sorting:[]});pe(async()=>{m()});const w=p=>{_=p,m()},m=async()=>{i.value=!0,await l.getProductsPaginated(_),i.value=!1},v=async p=>{u.value=!0,await l.addProduct(p)&&(e.value=!1),u.value=!1},C=async()=>{await l.exportProducts()};return(p,o)=>{const z=b("b-button"),D=b("b-col"),$=b("b-row");return c(),x(R,null,[r(ne,null,{default:n(()=>[r($,null,{default:n(()=>[r(D,{class:"d-flex flex-row-reverse mb-3"},{default:n(()=>[r(z,{variant:"primary",onClick:o[0]||(o[0]=M=>e.value=!0)},{default:n(()=>[k("New Product")]),_:1})]),_:1})]),_:1}),r($,null,{default:n(()=>[r(D,null,{default:n(()=>[r(Ie,{data:d(l).products,columns:d(Ke),loading:i.value,"current-page-meta":d(_),"table-pagination-meta":d(l).paginationMeta,onOnParamsChange:w,"filter-placeholder":"Search Products..."},{export:n(()=>[r(I,{variant:"success",size:"sm",pill:"",class:"mx-2",onClick:C,loading:d(l).exporting,disabled:i.value},{default:n(()=>[k("Export")]),_:1},8,["loading","disabled"])]),_:1},8,["data","columns","loading","current-page-meta","table-pagination-meta"]),Qe]),_:1})]),_:1})]),_:1}),e.value?(c(),h(Z,{key:0,title:"Add New Product",saving:u.value,onProceed:v,onCancel:o[1]||(o[1]=M=>e.value=!1)},null,8,["saving"])):V("",!0)],64)}}};export{ot as default};
